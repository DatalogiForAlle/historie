{% extends "base.html" %} 
{% load static %} 
{% load crispy_forms_tags %}
{% load data_tags %} 
{% block title %}Search{% endblock title %} 
{% block content %}

<script src="{% static 'js/search.js' %}"></script>


<div class="container">
<div class="row">
  <div class="col-9">
    <form method="get">
      <div class="row">
        <div class="col-sm">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="year" id="1850" value="1850" required>
            <label class="form-check-label" for="1850">
              1850
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="year" id="1901" value="1901">
            <label class="form-check-label" for="1901">
              1901
            </label>
          </div>
        </div>
        <div class="col-sm">
          <input class="form-control" name="q" id="id_q" required readonly>
        </div>
        <div class="col-sm">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="search_category" id="age" value="age">
            <label class="form-check-label" for="age" data-bs-toggle="tooltip" data-bs-placement="right" title="Explain something here">
              Alder
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="search_category" id="city" value="city">
            <label class="form-check-label" for="city" data-bs-toggle="tooltip" data-bs-placement="right" title="Explain something here">
              By
            </label>
          </div>
        </div>
      </div>
    </form>

    <div class="row">
      
      <div class="col-9" id="field-checkboxes">
        {% if page_obj %}


          <script>
            displayFieldCheckboxes("field-checkboxes")
          </script>

        {% else %}

          <script>
            sessionStorage.clear()
          </script>

        {% endif %}
      </div>
    </div>
    
    <!-- only show results and graph interface if we have a actually performed a search/gotten a page_obj-->
    {% if page_obj %}
    <div class="row">
      <div class="col-12" id="results">
        <div class="card border-0">
          <div class="card-body">
            <div class="row">
              <h6 class="card-title col-2" name="show-pa-id"> Pa ID</h6>
              <h6 class="card-title col-3" name="show-name">Navn</h6>
              <h6 class="card-title col-1" name="show-age">Alder</h6>
              <h6 class="card-title col-1" name="show-gender">Køn</h6>
              <h6 class="card-title col-3" name="show-status">Ægteskabelig Stilling</h6>
              <h6 class="card-title col-2" name="show-migrant">Migrant-type</h6>
            </div>
          </div>
        </div>
        {% for item in page_obj %}
          <div class="card mb-1">
            <div class="card-body">
              <div class="row">
                  <p class="card-title col-2" name="show-pa-id">{{ item.pa_id }}</p>
                  <p class="card-title col-3" name="show-name">{{ item.navn }}</p>
                  <p class="card-title col-1" name="show-age">{{ item.alder }}</p>
                  <p class="card-title col-1" name="show-gender">{{ item.køn }}</p>
                  <p class="card-title col-3" name="show-status">{{ item.ægteskabelig_stilling }}</p>
                  <p class="card-title col-2" name="show-migrant">{{ item.migrant_type }}</p>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    
    <div class="row">
      <!--show number of results in a style consistent with the pagination nav style-->
      <div class="col-6">
        <ul class="pagination">
          <li class="page-item disabled">
            <div class="page-link"> Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} results.
            </div>
          </li>
        </ul>
      </div>
      <div class="col-6">
        <!-- actual pagination starts here -->
        <nav aria-label="Search results pages">
          <ul class="pagination justify-content-end">
            {% if page_obj.has_previous %}
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page=1">
                  First</a></li>
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}
        
            {% if page_obj %}
              <li class="page-item disabled"><div class="page-link">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.</div>
              </li>
            {% endif %}
        
            {% if page_obj.has_next %}
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.next_page_number }}">Next</a></li>
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.paginator.num_pages }}">Last</a></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
    <!-- pagination ends here -->

    <!-- graph interface starts here-->
    <div class="mt-3">
      <h3>Create a graph</h3>
    </div>
    <div class="card mb-1">
        <!--choose x variable-->
        <div class="row g-0 border-bottom">
          <div class="col-3 border-end">
            <div class="card-body">
            Choose an X variable
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="gender-x" value="gender">
                    <label class="form-check-label" for="gender-x">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="status-x" value="status">
                    <label class="form-check-label" for="status-x">Ægteskabelig status</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="migrant-x" value="migrant">
                    <label class="form-check-label" for="migrant">Migranttype</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- choose y variable-->
        <div class="row g-0 border-bottom">
          <div class="col-3 border-end">
            <div class="card-body">
            Choose a Y variable
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="gender-y" value="gender" disabled>
                    <label class="form-check-label" for="gender-y">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="status-y" value="status" disabled>
                    <label class="form-check-label" for="status-y">Ægteskabelig status</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="migrant-y" value="migrant" disabled>
                    <label class="form-check-label" for="migrant-y">Migranttype</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- choose z variable-->
        <div class="row g-0">
          <div class="col-3 border-end">
            <div class="card-body">
            Choose a Z variable
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="gender-z" value="gender" disabled>
                    <label class="form-check-label" for="gender-z">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="status-z" value="status" disabled>
                    <label class="form-check-label" for="status-z">Ægteskabelig status</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="migrant-z" value="migrant" disabled>
                    <label class="form-check-label" for="migrant-z">Migranttype</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- graph interface ends here-->
    {% endif %}
    <!-- the stuff dependent on there being a search results ends here-->
    
  </div>
    <!-- first col-9 ends here -->
  
  <!-- Guide on how to use the page -->  
  <div class="col-3">
    <div class="card" style="width: 18rem;">
      <div class="card-body">
        <h5 class="card-title">Guide</h5>
        <p class="card-text">Explain something here</p>
        <p class="card-text">Explain something more here</p>
        <br>
        <br>
        <br>
        <p class="card-text">Keep explaining</p>
      </div>
    </div>
  </div>
</div>
<!-- first row ends here -->
</div>
<!-- first container ends here -->

<script type="text/javascript">
  
  keepUserInput("{{query}}", "{{year}}", "{{search_category}}");
  
  updateFieldBooleans();

  var toolTipList = getToolTipList()

  updateGraphChoices()
 
</script>

{% endblock content %}
