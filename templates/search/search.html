{% extends "base/base.html" %} 
{% load static %} 
{% load crispy_forms_tags %}
{% load data_tags %} 
{% block title %}Search{% endblock title %} 

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/search.css' %}">
{% endblock extra_css %}

{% block content %}

<script src="{% static 'js/search.js' %}"></script>
<script src="{% static 'js/myCharts.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<div class="container-fluid">
<div class="row">
  <div class="col-1"></div>
  <div class="col-8">
    <form method="get">

      <!-- buttons for choosing year -->
      {% include "search/year_choice.html" %}

      <!-- search fields  -->
      {% include "search/search_fields.html" %}

    </form>

    <div class="row">
      
        <div class="col-9" id="field-checkboxes">
            {% if page_obj %}

            <script>
                displayFieldCheckBoxes("{{year}}")
            </script>

            {% else %}

            <script>
                sessionStorage.clear()
            </script>

            {% endif %}
        </div>
    </div>
    
    <!-- only show results and graph interface if we have a actually performed a search/gotten a page_obj-->
    {% if page_obj %}
    <div class="row">
      <div class="col-12" id="results">
        <div class="card border-0">
          <div class="card-body">
            <div class="row">
              <h6 class="card-title col-1" name="show-pa-id"> Pa ID</h6>
              <h6 class="card-title col-2" name="show-name">Navn</h6>
              <h6 class="card-title col-2" name="show-age">Alder</h6>
              <h6 class="card-title col-2" name="show-gender">Køn</h6>
              <h6 class="card-title col-2" name="show-status">Ægteskabelig Stilling</h6>
              <h6 class="card-title col-2" name="show-location">Bostedstype</h6>
              <h6 class="card-title col-2" name="show-parish">Sogn/By</h6>
              <h6 class="card-title col-2" name="show-household-function-std">Stilling i husstanden</h6>
              <h6 class="card-title col-2" name="show-migration" style="display:none">Migranttype</h6>
            </div>
          </div>
        </div>
        {% for item in page_obj %}
          <div class="card mb-1">
            <div class="card-body">
              <div class="row">
                  <p class="card-title col-1" name="show-pa-id">{{ item.pa_id }}</p>
                  <p class="card-title col-2" name="show-name">{{ item.navn }}</p>
                  <p class="card-title col-2" name="show-age">{{ item.alder }}</p>
                  <p class="card-title col-2" name="show-gender">{{ item.køn }}</p>
                  <p class="card-title col-2" name="show-status">{{ item.ægteskabelig_stilling }}</p>
                  <p class="card-title col-2" name="show-location">{{ item.bostedstype }}</p>
                  <p class="card-title col-2" name="show-parish">{{ item.sogn_by }}</p>
                  <p class="card-title col-2" name="show-household-function-std">{{ item.stilling_i_husstanden_standardiseret }}</p>
                  {% if year != "1801" %} 
                    <p class="card-title col-2" name="show-migration">{{ item.migrant_type }}</p>
                  {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    
    <div class="row">
      <!--show number of results in a style consistent with the pagination nav style-->
      <div class="col-6">
        <ul class="pagination">
          <li class="page-item disabled">
            <div class="page-link"> Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} results.
            </div>
          </li>
        </ul>
      </div>
      <div class="col-6">
        <!-- actual pagination starts here -->
        <nav aria-label="Search results pages">
          <ul class="pagination justify-content-end">
            {% if page_obj.has_previous %}
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page=1">
                  First</a></li>
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}
        
            {% if page_obj %}
              <li class="page-item disabled"><div class="page-link">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.</div>
              </li>
            {% endif %}
        
            {% if page_obj.has_next %}
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.next_page_number }}">Next</a></li>
              <li class="page-item"><a class="page-link" href="?{{ parameters }}&page={{ page_obj.paginator.num_pages }}">Last</a></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
    <!-- pagination ends here -->

    <!-- graph interface starts here-->
    <div class="mt-3">
      <h3>Charts</h3>
    </div>
    <div class="card mb-1">
        <!--choose x variable-->
        <div class="row g-0 border-bottom">
          <div class="col-3 border-end">
            <div class="card-body">
            Vælg en X variabel
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="gender-x" value="gender">
                    <label class="form-check-label" for="gender-x">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="status-x" value="status">
                    <label class="form-check-label" for="status-x">Ægteskabelig status</label>
                </div>
                <!-- <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="migrant-x" value="migrant">
                    <label class="form-check-label" for="migrant">Migranttype</label>
                </div> -->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="x" id="location-x" value="location">
                  <label class="form-check-label" for="location-x">Bostedstype</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="county-x" value="county">
                    <label class="form-check-label" for="county-x">Amt</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="x" id="five-x" value="five">
                    <label class="form-check-label" for="five-x">5 års aldersgrupper</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- choose y variable-->
        <div class="row g-0 border-bottom">
          <div class="col-3 border-end">
            <div class="card-body">
            Vælg en Y variabel
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="gender-y" value="gender" disabled>
                    <label class="form-check-label" for="gender-y">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="status-y" value="status" disabled>
                    <label class="form-check-label" for="status-y">Ægteskabelig status</label>
                </div>
                <!-- <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="migrant-y" value="migrant" disabled>
                    <label class="form-check-label" for="migrant-y">Migranttype</label>
                </div> -->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="y" id="location-y" value="location" disabled>
                  <label class="form-check-label" for="location-y">Bostedstype</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="county-y" 
                    value="county" disabled>
                    <label class="form-check-label" for="county-y">Amt</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y" id="five-y" 
                    value="five" disabled>
                    <label class="form-check-label" for="five-y">5 års aldersgrupper</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- choose z variable-->
        <div class="row g-0">
          <div class="col-3 border-end">
            <div class="card-body">
            Vælg en Z variabel
            </div>
          </div>
          <div class="col-9">
            <div class="card-body">
              <div style="display:flex">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="gender-z" value="gender" disabled>
                    <label class="form-check-label" for="gender-z">Køn</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="status-z" value="status" disabled>
                    <label class="form-check-label" for="status-z">Ægteskabelig status</label>
                </div>
                <!-- <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="migrant-z" value="migrant" disabled>
                    <label class="form-check-label" for="migrant-z">Migranttype</label>
                </div> -->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="z" id="location-z" value="location" disabled>
                  <label class="form-check-label" for="location-z">Bostedstype</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="county-z" 
                    value="county" disabled>
                    <label class="form-check-label" for="county-z">Amt</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="z" id="five-z" 
                    value="five" disabled>
                    <label class="form-check-label" for="five-z">5 års aldersgrupper</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- graph input button ends here-->

      <!-- buttons for choosing a chart type -->
      <div class="card mb-1">
        <div class="card-body text-center">
          <div class="row">
            <div class="col">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#chart-modal" id="pie-btn" style="display: visibility;">
                Pie Chart
              </button>
            </div>
            <div class="col">
              <button type="button" class="btn btn-primary" 
              data-bs-toggle="modal" data-bs-target="#chart-modal" id="line-btn" style="display: visibility;">
                Line Chart
              </button>
            </div>
            <div class="col">
              <button type="button" class="btn btn-primary"
              data-bs-toggle="modal" data-bs-target="#chart-modal" id="bar-btn" style="display: visibility;">
                Bar Chart
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- popup/modal for showing and downloading chart-->
      <div class="modal fade" id="chart-modal" tabindex="-1">
        <div class="modal-dialog modal-xl" id="modal-size">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="chart-modal-label">Chart</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="chart-modal-body">
              <canvas id="chart-canvas" style="min-width:100%;min-height:100%;"></canvas>
              <a id="chart-download" style="visibility:hidden">
                <button type="button" class="btn btn-primary float-end">Download</button>
              </a>
            </div>

          </div>
        </div>
      </div>
    {% endif %}
    <!-- the stuff dependent on there being a search results ends here-->
    
  </div>
    <!-- first col-9 ends here -->
  
  <!-- Guide on how to use the page -->  
  <div class="col-3">
    <div class="card" style="width: 18rem;">
      <div class="card-body">
        <h5 class="card-title">Guide</h5>
        <p class="card-text">Tryk enter for at søge efter du har valgt et årstal og evt et filter at søge ind i.</p>
        <p class="card-text">Forklar noget mere her</p>
        <br>
        <br>
        <br>
        <p class="card-text">Forklar endnu mere her</p>
      </div>
    </div>
  </div>
</div>
<!-- first row ends here -->
</div>
<!-- first container ends here -->

<script type="text/javascript">
  
  keepUserInput("{{year}}", "{{search_category_1}}", "{{query_1}}", "{{search_category_2}}", "{{query_2}}", "{{combine}}");

  keepFieldCheckboxInput("{{year}}")

  var toolTipList = getToolTipList()
  
  updateGraphInput()
  recallGraphInput()
  recallDisabledGraphButtons()
  showChart() 
 
</script>

{% endblock content %}
